[{"specVersion":"1.0","workflow":{"gid":3595,"category":"category001","creator":"trial_user06","name":"workflowSample","description":"description info","createTime":1618382071000,"updateTime":1618387930000,"jobCount":0,"unknownCount":0,"workflowDefinition":{"components":[{"componentType":"batch","type":"batch","setting":{"properties":{"notifyLevel":{"level":"ERROR","messengerId":""},"workflow":{"name":"workflowSample","appName":"G3595","alias":"","libPath":"/tmp/lib/batch","useSystemLibPath":true,"xml":"<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n<Workflow xmlns=\"uri:oozie:workflow:0.5\" xmlns:ns6=\"uri:oozie:distcp-action:0.2\" xmlns:ns5=\"uri:oozie:ssh-action:0.2\" xmlns:ns7=\"uri:oozie:spark-action:0.2\" xmlns:ns2=\"uri:oozie:hive-action:0.6\" xmlns:ns4=\"uri:oozie:shell-action:0.3\" xmlns:ns3=\"uri:oozie:sqoop-action:0.4\">\n    <start to=\"tT0I-r95V-3q2S-Nhpz-tYem-Z6ZM-820f-Ua5Y\"/>\n    <action name=\"tT0I-r95V-3q2S-Nhpz-tYem-Z6ZM-820f-Ua5Y\">\n        <ns7:spark>\n            <ns7:job-tracker>${jobTracker}</ns7:job-tracker>\n            <ns7:name-node>${nameNode}</ns7:name-node>\n            <ns7:configuration>\n                <ns7:property>\n                    <ns7:name>oozie.action.sharelib.for.spark</ns7:name>\n                    <ns7:value>spark2</ns7:value>\n                </ns7:property>\n            </ns7:configuration>\n            <ns7:master>yarn</ns7:master>\n            <ns7:mode>cluster</ns7:mode>\n            <ns7:name>workflowSample</ns7:name>\n            <ns7:jar>tT0I-r95V-3q2S-Nhpz-tYem-Z6ZM-820f-Ua5Y.py</ns7:jar>\n            <ns7:spark-opts>--py-files asset.py --conf spark.yarn.appMasterEnv.PYSPARK_PYTHON=/usr/bin/python3.6 --conf spark.executorEnv.PYSPARK_PYTHON=/usr/bin/python3.6 --conf spark.yarn.appMasterEnv.PYTHONPATH=/home/dpcore/.local/lib/python3.6/site-packages --conf spark.executorEnv.PYTHONPATH=/home/dpcore/.local/lib/python3.6/site-packages</ns7:spark-opts>\n        </ns7:spark>\n        <ok to=\"end\"/>\n        <error to=\"kill\"/>\n    </action>\n    <kill name=\"kill\">\n        <message>killed</message>\n    </kill>\n    <end name=\"end\"/>\n</Workflow>\n"},"cluster":{"stackId":"EMR_119"},"notification":{"event":[],"notificationReceiver":[]}}},"scheduler":{"properties":{"enable":false,"start":null,"end":null,"timezone":"GMT+09:00","frequency":{"inputType":"Basic","frequencyNumber":5,"frequencyUnit":"minutes","frequencyCron":""},"controls":{"timeout":"-1","concurrency":"1","execution":"FIFO","throttle":"12"},"datasets":{"inputEvents":[{"name":"","uriTemplate":"","frequency":"","initialInstance":"","timezone":"","doneFlag":""}],"outputEvents":[{"name":"","uriTemplate":"","frequency":"","initialInstance":"","timezone":"","doneFlag":""}]}}},"jobProperty":{"properties":{"parameters":[{"key":"jobPropertyKey","value":"jobPropertyValue"}]}},"nodes":[{"uuid":"tT0I-r95V-3q2S-Nhpz-tYem-Z6ZM-820f-Ua5Y","type":"ETL","label":"전처리","group":"hadoopBatch","link":[],"parent":"","child":[],"props":{"appName":"workflowSample","source":"#-- coding: utf-8 --\nimport sys\nsys.path.insert(0, \"/home/dpcore/.local/lib/python3.6/site-packages\")\n\nfrom pyspark.sql import SparkSession\nfrom pyspark import SparkContext, SparkConf\nfrom pyspark.sql.types import *\nfrom pyspark.sql import functions as F\nfrom pyspark.sql.window import Window\nfrom pyspark.sql.functions import udf, col, lit, concat, last, avg, when, trim, ltrim, rtrim\nfrom pyspark.ml.feature import *\nfrom pyspark.ml import *\nimport json, csv, io, re, urllib\n\nconf = SparkConf().setAppName(\"pysparkApp\").set(\"spark.driver.cores\", 1).set(\"spark.driver.memory\", \"1G\").set(\"spark.executor.cores\", 1).set(\"spark.executor.memory\", \"1G\").set(\"spark.executor.instances\", 3)\nsqlContext = SparkSession.builder.config(conf=conf).enableHiveSupport().getOrCreate()\nsc = sqlContext.sparkContext\nsqlContext.sparkContext.addPyFile('asset.py')\nfrom asset import *\n\n# S3 불러오기 Credential\nsc._jsc.hadoopConfiguration().set(\"fs.s3a.impl\",\"org.apache.hadoop.fs.s3a.S3AFileSystem\")\nsc._jsc.hadoopConfiguration().set(\"fs.s3a.access.key\", \"AKIA2HASEMBXSFKL33FT\")\nsc._jsc.hadoopConfiguration().set(\"fs.s3a.secret.key\", \"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\")\nsc._jsc.hadoopConfiguration().set(\"fs.s3a.endpoint\", \"s3.ap-northeast-2.amazonaws.com\")\n\n# S3 불러오기 Custom Schema\ncustomSchema_E540 = StructType([StructField(\"type\", IntegerType(), True), StructField(\"amount\", DoubleType(), True), StructField(\"nameOrig\", StringType(), True), StructField(\"oldbalanceOrig\", DoubleType(), True), StructField(\"newbalanceOrig\", DoubleType(), True), StructField(\"nameDest\", StringType(), True), StructField(\"oldbalanceDest\", DoubleType(), True), StructField(\"newbalanceDest\", DoubleType(), True), StructField(\"isFraud\", IntegerType(), True)])\n\n# S3 불러오기\ndf_E540 = sqlContext.read.option(\"delimiter\", \"\u0001\").option(\"header\", \"true\").csv(sc.textFile(\"s3a://accu-trial/example/train_val_set2.csv\").map(lambda line : \"\u0001\".join(line.split(\",\"))), schema = customSchema_E540)\n\n# Activate Smart Parser\ndf_E540 = smartParser(df_E540, \"none\", 0)\n\n# random\ndf_p5Vb = df_E540\n\nsc.stop()","sampling":"limit","limit":"10000000","argument":[{"arg":""}],"sparkOpts":[{"key":"","value":""}],"pysparkPython":"/usr/bin/python3.6","pythonPath":"/home/dpcore/.local/lib/python3.6/site-packages","mode":"cluster","forceOK":false}},{"uuid":"E540-6M86-LM04-8c7B-wIv7-49G4-sx3q-qS4N","name":"S3 불러오기_E540","type":"importS3","label":"S3 불러오기","group":"hadoopBatch","link":["p5Vb-2j5s-16lQ-6g2P-OkAe-XhTp-9gxM-WCQ1"],"parent":"tT0I-r95V-3q2S-Nhpz-tYem-Z6ZM-820f-Ua5Y","child":[],"props":{"file":"s3a://accu-trial/example/train_val_set2.csv","format":"csv","delimiter":",","option":[{"key":"header","value":"true"}],"schema":[{"column":"type","dataType":"IntegerType()"},{"column":"amount","dataType":"DoubleType()"},{"column":"nameOrig","dataType":"StringType()"},{"column":"oldbalanceOrig","dataType":"DoubleType()"},{"column":"newbalanceOrig","dataType":"DoubleType()"},{"column":"nameDest","dataType":"StringType()"},{"column":"oldbalanceDest","dataType":"DoubleType()"},{"column":"newbalanceDest","dataType":"DoubleType()"},{"column":"isFraud","dataType":"IntegerType()"}],"credential":{"fs.s3a.access.key":"AKIA2HASEMBXSFKL33FT","fs.s3a.secret.key":"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","fs.s3a.endpoint":"s3.ap-northeast-2.amazonaws.com"}}},{"uuid":"p5Vb-2j5s-16lQ-6g2P-OkAe-XhTp-9gxM-WCQ1","name":"random_p5Vb","type":"random","label":"random","group":"hadoopBatch","link":[],"parent":"tT0I-r95V-3q2S-Nhpz-tYem-Z6ZM-820f-Ua5Y","child":[],"props":{"withReplacement":"False","fraction":0.05,"seed":0,"includeJob":false,"purpose":"job"}}],"extraProps":{"clusterInfo":{"hiveIP":"10.31.200.175","ozIP":"10.31.200.175","hosts":{"ip-10-31-200-175.ap-northeast-2.compute.internal":"10.31.200.175","hdp-master01":"10.31.200.175"},"nnPort":"8020","hivePort":"10000","mrJobHstIP":"10.31.200.175","mrJobHstPort":"19888","pythonPath":"/usr/bin/python3.6","ozPort":"11000","pythonPackagePath":"/home/dpcore/.local/lib/python3.6/site-packages","livyIP":"10.31.200.175","rmPort":"8032","jupyterIP":"10.31.200.175","nnIP":"10.31.200.175","jupyterPort":"8890","rmIP":"10.31.200.175","livyPort":"8998","hdfsIP":"10.31.200.175","rmwebPort":"8088","nmPort":"8040","nmWebPort":"8042","nnWebPort":"50070"}},"workflow":{"id":"3122","name":"workflowSample","appName":"G3595"}}]}},"workflowJson":"{\"tT0I-r95V-3q2S-Nhpz-tYem-Z6ZM-820f-Ua5Y\":\"-330 -160\",\"E540-6M86-LM04-8c7B-wIv7-49G4-sx3q-qS4N\":\"-330 -160\",\"p5Vb-2j5s-16lQ-6g2P-OkAe-XhTp-9gxM-WCQ1\":\"-330 -80\"}"}]